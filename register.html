<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Register - Aquatic Store</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(to bottom right, #c0f0ff, #0077b6);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        text-align: center;
      }

      h2 {
        font-family: "Lucida Sans", sans-serif;
      }

      input {
        padding: 10px;
        border-radius: 10px;
        margin: 10px;
        width: 250px;
        border: none;
      }

      button {
        padding: 10px 20px;
        cursor: pointer;
        background-color: #0077b6;
        color: white;
        border-radius: 50px;
        border: none;
        margin-top: 10px;
      }

      #reg-error {
        color: white;
        margin-top: 10px;
      }

      #otp-section {
        display: none;
      }

      a {
        color: #004d7a;
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <h2>Create Your Account</h2>
    <input type="email" id="reg-email" placeholder="Email" required />
    <button onclick="sendOTP()">Send OTP</button>

    <div id="otp-section">
      <input type="text" id="otp" placeholder="Enter OTP" />
      <button onclick="verifyOTP()">Verify OTP</button>
    </div>

    <input
      type="password"
      id="reg-password"
      placeholder="Password"
      required
      style="display: none"
    />
    <button id="register-btn" onclick="register()" style="display: none">
      Register
    </button>

    <p id="reg-error"></p>
    <p>Already have an account? <a href="index.html">Login</a></p>

    <script>
      let otpVerified = false;

      function sendOTP() {
        const email = document.getElementById("reg-email").value.trim();
        const error = document.getElementById("reg-error");

        if (!email) {
          error.textContent = "Please enter a valid email.";
          return;
        }

        fetch("http://localhost:3000/send-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        })
          .then((res) => res.json())
          .then((data) => {
            error.textContent = data.message;
            if (data.success) {
              document.getElementById("otp-section").style.display = "block";
            }
          });
      }

      function verifyOTP() {
        const email = document.getElementById("reg-email").value.trim();
        const otp = document.getElementById("otp").value.trim();
        const error = document.getElementById("reg-error");

        fetch("http://localhost:3000/verify-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, otp }),
        })
          .then((res) => res.json())
          .then((data) => {
            error.textContent = data.message;
            if (data.success) {
              otpVerified = true;
              document.getElementById("reg-password").style.display = "block";
              document.getElementById("register-btn").style.display =
                "inline-block";
            }
          });
      }

      function register() {
        const email = document.getElementById("reg-email").value.trim();
        const password = document.getElementById("reg-password").value.trim();
        const error = document.getElementById("reg-error");

        if (!otpVerified) {
          error.textContent = "Please verify your email first.";
          return;
        }

        if (!email || !password) {
          error.textContent = "All fields are required.";
          return;
        }

        const existingEmail = localStorage.getItem("userEmail");

        if (existingEmail === email) {
          error.textContent = "Email is already registered.";
          return;
        }

        localStorage.setItem("userEmail", email);
        localStorage.setItem("userPassword", password);
        alert("Registered successfully! Please login.");
        window.location.href = "index.html";
      }
    </script>
  </body>
</html>
